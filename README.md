# 蔚蓝档案 Blue Archive MCP 服务器

这是一个用于蔚蓝档案（Blue Archive）游戏的 MCP (Model Context Protocol) 服务器，提供了丰富的游戏数据查询功能。

## 功能特点

- 🏫 **学生信息查询** - 获取所有学生的详细信息，包括属性、技能、装备等
- 🔍 **智能搜索** - 支持按名称、学校、社团等条件搜索学生
- 🎭 **角色变体** - 查找学生的所有变体版本（节日版、特殊版等）
- 🖼️ **头像系统** - 获取学生头像图片，支持多种头像类型
- ⚔️ **团队战数据** - 获取RAID活动信息和BOSS数据
- ⚙️ **装备系统** - 查询装备的属性、获取方式等
- 🎯 **多语言支持** - 支持中文、英文、日文、韩文、泰文、繁体中文等
- 💾 **智能缓存** - 1小时客户端缓存，提升查询性能
- 🔧 **自定义查询** - 支持按条件过滤和搜索

## 安装步骤

### 1. 安装依赖

```bash
cd blue_archive_mcp
npm install
```

### 2. 构建项目

```bash
npm run build
```

### 3. 启动服务器

```bash
npm start
```

## 可用工具

### 1. `get_students`
获取学生列表，支持多种筛选条件和语言选择

**参数：**
- `language` (string): 语言代码 (cn, en, jp, kr, th, tw) 默认为 "cn"
- `search` (string): 搜索关键词（学生名称、学校、社团）
- `limit` (number): 返回数量限制，默认 20
- `detailed` (boolean): 是否返回详细信息，默认 false

### 2. `get_student_by_name`
通过名称精确查找学生信息，支持模糊匹配

**参数：**
- `name` (string): 学生名称（必填）
- `language` (string): 语言代码，默认为 "cn"
- `detailed` (boolean): 是否返回详细信息，默认 false

### 3. `find_student_variants`
查找学生的所有变体版本（如节日版、特殊版等），基于名称相似度匹配

**参数：**
- `name` (string): 学生名称（必填）
- `language` (string): 语言代码，默认为 "cn"
- `includeOriginal` (boolean): 是否包含原版学生，默认 true
- `format` (string): 输出格式 (text, markdown, md)，默认为 "text"

### 4. `get_student_avatar`
获取学生头像图片，支持多种头像类型

**参数：**
- `studentId` (number): 学生ID（可选）
- `name` (string): 学生名称（可选）
- `avatarType` (string): 头像类型 (Portrait, Collection, Lobby, etc.)，默认为 "Portrait"
- `language` (string): 语言代码，默认为 "cn"

### 5. `get_multiple_student_avatars`
批量获取多个学生的头像，适用于需要展示多个角色的场景

**参数：**
- `studentIds` (array): 学生ID数组（必填）
- `avatarType` (string): 头像类型，默认为 "Portrait"
- `language` (string): 语言代码，默认为 "cn"

### 6. `get_raids`
获取总力战（团队战）活动信息，包括BOSS数据和奖励

**参数：**
- `language` (string): 语言代码，默认为 "cn"
- `search` (string): 按活动名称搜索
- `detailed` (boolean): 是否返回详细信息，默认 false

### 7. `get_equipment`
获取装备列表信息，支持按类别和等级筛选

**参数：**
- `language` (string): 语言代码，默认为 "cn"
- `category` (string): 装备类别 (Hat, Glove, Shoes, Bag, Badge, Charm, Haar Accessory, Necktie)
- `tier` (number): 装备等级 (1-3)
- `limit` (number): 返回数量限制，默认 20
- `detailed` (boolean): 是否返回详细信息，默认 false

### 8. `get_game_config`
获取游戏配置信息和服务器状态

**参数：**
- `includeRegions` (boolean): 是否包含地区信息，默认 true

## 在 Claude Desktop 中使用

### 1. 配置服务器

在 `%APPDATA%/Claude/claude_desktop_config.json` 或 `~/Library/Application Support/Claude/claude_desktop_config.json` 中添加：

```json
{
  "mcpServers": {
    "blue-archive": {
      "command": "node",
      "args": ["f:\\BA MCPtool\\blue_archive_mcp\\dist\\index.js"]
    }
  }
}
```

**注意：Windows 路径使用双斜杠或正斜杠**

### 2. 重启 Claude Desktop

保存配置文件后重启 Claude Desktop，MCP 工具就会加载完成。

### 3. 使用方法

在 Claude 中可以直接使用自然语言查询：

```
查询一下阿露的详细信息
我想要2级帽子装备
有什么团队战活动吗？
查一下亚比学院的学生
找一下阿露的所有变体版本
获取学生的头像
```

## 测试工具

项目包含了多个测试脚本来验证功能：

### 1. 基础功能测试
```bash
node simple_test.cjs
```
测试基本的学生查询和变体查找功能。

### 2. 全面功能测试
```bash
node comprehensive_test.cjs
```
测试所有工具的完整功能，包括：
- 学生列表获取
- 名称查找
- 变体查找
- 总力战信息
- 装备查询

## 数据来源

所有数据来自 SchaleDB 网站 (https://schaledb.com)，这是蔚蓝档案游戏的权威数据源。

- 实时更新：数据与游戏版本同步更新
- 多语言：完整支持所有官方语言版本
- 免费可靠：社区维护，稳定性高

## 示例查询

### 学生信息
- "找一些治疗学生" → 查询康复位置的学生
- "哪些学生是突击队" → 查找Striker位置的学生
- "阿比学院有什么学生" → 查询特定学校的学生

### 装备系统
- "显示所有3级装备" → 查看高级装备
- "有什么手套装备" → 查找特定类别装备
- "我需要Badge装备" → 饰品类装备查询

### 战斗数据
- "列出所有团队战" → 获取所有RAID活动
- "查找困难团队战" → 查询高难度活动
- "秋季活动的详细信息" → 具体活动信息

## 高级用法

### 缓存机制

服务器实现了智能缓存：
- 缓存时间：1小时
- 自动过期：超过TTL自动刷新
- 内存优化：防止内存泄漏

### 错误处理

- 网络错误重试机制
- 数据不存在时友好提示
- API调用超时保护

### 性能优化

- 支持压缩数据格式 (.min.json)
- 分页查询结果
- 并发网络请求处理

## 故障排除

### 连接问题
1. 确认路径配置正确
2. 检查 Node.js 版本 (需要 v18+)
3. 验证构建文件存在

### 数据加载失败
1. 检查网络连接
2. 确认 SchaleDB 服务可用
3. 查看 Claude Desktop 日志

### 工具不显示
1. 重启 Claude Desktop
2. 检查配置文件语法
3. 确认服务器进程正在运行

## 未来功能计划

### 🚀 即将实现的功能

#### 1. 语音系统重构 🎵
- **目标**: 重新设计语音功能，解决当前的数据显示问题
- **计划**: 
  - 优化语音数据结构和输出格式
  - 支持多种语音类型（战斗、大厅、活动等）
  - 添加音频播放链接和控件
  - 批量语音获取功能
- **预计时间**: 下个版本

#### 2. 学生技能详情 ⚡
- **目标**: 提供完整的学生技能信息
- **计划**:
  - 技能描述和效果详情
  - 技能升级数据
  - 技能动画和图标
  - 技能搭配推荐
- **预计时间**: 2-3周内

#### 3. 装备强化系统 🔧
- **目标**: 完善装备相关功能
- **计划**:
  - 装备强化材料需求
  - 装备获取途径详情
  - 装备搭配推荐
  - 装备效果计算器
- **预计时间**: 1个月内

#### 4. 活动和关卡信息 🎯
- **目标**: 添加游戏内容查询功能
- **计划**:
  - 主线关卡信息
  - 活动关卡详情
  - 掉落物品查询
  - 关卡攻略建议
- **预计时间**: 1-2个月内

#### 5. 学生培养指南 📚
- **目标**: 提供角色培养建议
- **计划**:
  - 学生评级和定位分析
  - 培养优先级推荐
  - 技能升级建议
  - 装备搭配方案
- **预计时间**: 2个月内

#### 6. 数据可视化 📊
- **目标**: 提供图表和可视化数据
- **计划**:
  - 学生属性对比图表
  - 装备效果可视化
  - 团队战数据分析
  - 活动奖励统计
- **预计时间**: 3个月内

### 🔮 长期规划

#### 1. 实时数据同步 🔄
- 与游戏服务器数据实时同步
- 自动更新游戏版本变更
- 推送重要更新通知

#### 2. 个性化推荐 🎯
- 基于用户查询历史的智能推荐
- 个性化学生和装备建议
- 自定义关注列表

#### 3. 社区功能 👥
- 用户评论和评分系统
- 攻略分享平台
- 社区投票和排行榜

#### 4. 移动端支持 📱
- 移动设备优化
- 响应式界面设计
- 离线数据缓存

#### 5. API 扩展 🔌
- RESTful API 接口
- GraphQL 支持
- 第三方集成能力

### 📝 贡献指南

如果您对以上功能有建议或想要参与开发，欢迎：

1. 提交 Issue 描述需求或问题
2. Fork 项目并提交 Pull Request
3. 参与讨论和功能设计
4. 提供测试和反馈

## 技术说明

- **框架**: TypeScript + MCP SDK
- **传输**: STDIO (标准输入输出)
- **缓存**: 内存 Map 实现
- **网络**: 原生 fetch API
- **错误处理**: 完整的异常捕获和友好提示

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个工具！

---

**数据使用免责声明**: 本工具仅用于学习和娱乐目的，游戏数据来源于 SchaleDB，请遵守相关法律法规和游戏使用条款。
